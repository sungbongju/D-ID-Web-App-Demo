<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D-ID Agent ìƒí˜¸ì‘ìš© í…ŒìŠ¤íŠ¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f7fa;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .test-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .test-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .test-section p {
            color: #666;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .button-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .test-btn {
            padding: 15px 25px;
            font-size: 16px;
            font-weight: 600;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, #2196F3 0%, #21CBF3 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .info-box {
            padding: 20px;
            background: #e7f3ff;
            border-left: 4px solid #2196f3;
            border-radius: 8px;
            margin: 15px 0;
        }

        .success-box {
            padding: 20px;
            background: #d4edda;
            border-left: 4px solid #28a745;
            border-radius: 8px;
            margin: 15px 0;
        }

        .log-area {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-bottom: 1px solid #333;
        }

        .timestamp {
            color: #888;
            margin-right: 10px;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin: 10px 0;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-connected {
            background: #28a745;
            box-shadow: 0 0 10px #28a745;
        }

        .status-disconnected {
            background: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ”¬ D-ID Agent ìƒí˜¸ì‘ìš© í…ŒìŠ¤íŠ¸</h1>
            <p>HTML ë²„íŠ¼ í´ë¦­ â†’ D-ID Agent ë©”ì‹œì§€ ì „ë‹¬ ì‹¤í—˜</p>
        </header>

        <!-- ìƒíƒœ í‘œì‹œ -->
        <div class="test-section">
            <h2>ğŸ“¡ Agent ì—°ê²° ìƒíƒœ</h2>
            <div id="agentStatus">
                <span class="status-indicator status-disconnected"></span>
                <span id="statusText">Agent ë¡œë”© ì¤‘...</span>
            </div>
            <div class="log-area" id="logArea">
                <div class="log-entry">
                    <span class="timestamp">[ì‹œì‘]</span> ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...
                </div>
            </div>
        </div>

        <!-- í…ŒìŠ¤íŠ¸ 1: ë¯¸ë¦¬ ì •ì˜ëœ í”„ë¡¬í”„íŠ¸ -->
        <div class="test-section">
            <h2>ğŸ¯ í…ŒìŠ¤íŠ¸ 1: ë¯¸ë¦¬ ì •ì˜ëœ ì§ˆë¬¸ ì „ì†¡</h2>
            <p>ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ í•´ë‹¹ ì§ˆë¬¸ì´ D-ID Agentì—ê²Œ ì „ë‹¬ë©ë‹ˆë‹¤.</p>
            
            <div class="button-group">
                <button class="test-btn btn-primary" onclick="sendPredefinedPrompt('ì·¨ì—…ë¥ ')">
                    ğŸ“Š ì·¨ì—…ë¥  ì§ˆë¬¸í•˜ê¸°
                </button>
                <button class="test-btn btn-success" onclick="sendPredefinedPrompt('ë°”ì´ì˜¤ìœµí•©')">
                    ğŸ§¬ ë°”ì´ì˜¤ìœµí•© ì§ˆë¬¸í•˜ê¸°
                </button>
                <button class="test-btn btn-info" onclick="sendPredefinedPrompt('ì„¸ë¶€ì „ê³µ')">
                    ğŸ“š ì„¸ë¶€ì „ê³µ ì§ˆë¬¸í•˜ê¸°
                </button>
                <button class="test-btn btn-warning" onclick="sendPredefinedPrompt('ì°¨ë³„ì ')">
                    ğŸ¥ ì°¨ëŒ€ ì°¨ë³„ì  ì§ˆë¬¸í•˜ê¸°
                </button>
            </div>
            
            <div class="info-box">
                <strong>ğŸ’¡ ì‘ë™ ì›ë¦¬:</strong><br>
                1. ë²„íŠ¼ í´ë¦­ ì‹œ ë¯¸ë¦¬ ì •ì˜ëœ ì§ˆë¬¸ ì„ íƒ<br>
                2. D-ID Agent iframe ì°¾ê¸°<br>
                3. postMessage ë˜ëŠ” ì§ì ‘ ì…ë ¥ ì‹œë®¬ë ˆì´ì…˜<br>
                4. Agent ì‘ë‹µ ëŒ€ê¸°
            </div>
        </div>

        <!-- í…ŒìŠ¤íŠ¸ 2: ì‚¬ìš©ì ì •ì˜ í”„ë¡¬í”„íŠ¸ -->
        <div class="test-section">
            <h2>âœï¸ í…ŒìŠ¤íŠ¸ 2: ì‚¬ìš©ì ì •ì˜ í”„ë¡¬í”„íŠ¸</h2>
            <p>ì›í•˜ëŠ” ì§ˆë¬¸ì„ ì§ì ‘ ì‘ì„±í•˜ì—¬ ì „ì†¡í•´ë³´ì„¸ìš”.</p>
            
            <input type="text" id="customPrompt" placeholder="ì˜ˆ: ê²½ì˜í•™ì „ê³µì˜ íŠ¹ì§•ì€ ë¬´ì—‡ì¸ê°€ìš”?">
            <button class="test-btn btn-primary" onclick="sendCustomPrompt()" style="width: 100%; margin-top: 10px;">
                ğŸ“¤ ì§ì ‘ ì‘ì„±í•œ ì§ˆë¬¸ ì „ì†¡
            </button>
            
            <div class="success-box">
                <strong>âœ… í™œìš© ì˜ˆì‹œ:</strong><br>
                â€¢ "ì¡¸ì—…ìƒë“¤ì€ ì£¼ë¡œ ì–´ë””ë¡œ ì·¨ì—…í•˜ë‚˜ìš”?"<br>
                â€¢ "ìˆ˜í•™ì„ ëª»í•´ë„ ë”°ë¼ê°ˆ ìˆ˜ ìˆë‚˜ìš”?"<br>
                â€¢ "íŒ€í”„ë¡œì íŠ¸ê°€ ë§ë‹¤ë˜ë° ì •ë§ì¸ê°€ìš”?"
            </div>
        </div>

        <!-- í…ŒìŠ¤íŠ¸ 3: ì»¨í…ìŠ¤íŠ¸ í¬í•¨ í”„ë¡¬í”„íŠ¸ -->
        <div class="test-section">
            <h2>ğŸ“ í…ŒìŠ¤íŠ¸ 3: í•™ìƒ ì •ë³´ + ì§ˆë¬¸</h2>
            <p>í•™ìƒì˜ ë°°ê²½ì •ë³´ë¥¼ í¬í•¨í•˜ì—¬ ë§ì¶¤í˜• ë‹µë³€ ìš”ì²­</p>
            
            <input type="text" id="studentName" placeholder="ì´ë¦„ (ì˜ˆ: í™ê¸¸ë™)">
            <input type="text" id="studentInterest" placeholder="ê´€ì‹¬ë¶„ì•¼ (ì˜ˆ: ë°”ì´ì˜¤, ë§ˆì¼€íŒ…, ë°ì´í„°ë¶„ì„)">
            
            <div class="button-group">
                <button class="test-btn btn-success" onclick="sendContextPrompt('ì§„ë¡œì¶”ì²œ')">
                    ğŸ¯ ë§ì¶¤ ì§„ë¡œ ì¶”ì²œë°›ê¸°
                </button>
                <button class="test-btn btn-info" onclick="sendContextPrompt('ë³µìˆ˜ì „ê³µ')">
                    ğŸ“š ë³µìˆ˜ì „ê³µ ì¶”ì²œë°›ê¸°
                </button>
            </div>
        </div>

        <!-- í…ŒìŠ¤íŠ¸ 4: ì—°ì† ëŒ€í™” ì‹œë®¬ë ˆì´ì…˜ -->
        <div class="test-section">
            <h2>ğŸ’¬ í…ŒìŠ¤íŠ¸ 4: ì—°ì† ëŒ€í™” íë¦„</h2>
            <p>ì—¬ëŸ¬ ì§ˆë¬¸ì„ ìˆœì°¨ì ìœ¼ë¡œ ì „ì†¡í•˜ì—¬ ëŒ€í™” íë¦„ í…ŒìŠ¤íŠ¸</p>
            
            <button class="test-btn btn-warning" onclick="startConversationFlow()" style="width: 100%;">
                ğŸ”„ ëŒ€í™” ì‹œë‚˜ë¦¬ì˜¤ ì‹œì‘ (3ë‹¨ê³„)
            </button>
            
            <div id="conversationStatus" style="margin-top: 15px;"></div>
        </div>
    </div>

    <!-- D-ID Agent ìŠ¤í¬ë¦½íŠ¸ -->
    <script type="module">
        const script = document.createElement('script');
        script.type = 'module';
        script.src = 'https://agent.d-id.com/v2/index.js';
        script.setAttribute('data-mode', 'fabio');
        script.setAttribute('data-client-key', 'Z29vZ2xlLW9hdXRoMnwxMTI3NjQ3MzA0NTM3NjA0MTgyMTI6d01EN0x6bFFFMmlZSk9nUHNacXll');
        script.setAttribute('data-agent-id', 'v2_agt_80jV_9EA');
        script.setAttribute('data-name', 'did-agent');
        
        script.onload = () => {
            addLog('âœ… D-ID Agent ë¡œë”© ì™„ë£Œ');
            updateAgentStatus(true);
        };
        
        script.onerror = (e) => {
            addLog('âŒ D-ID Agent ë¡œë”© ì‹¤íŒ¨', 'error');
            updateAgentStatus(false);
        };
        
        document.body.appendChild(script);
    </script>

    <script>
        // ë¡œê·¸ ì¶”ê°€ í•¨ìˆ˜
        function addLog(message, type = 'info') {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff4444' : type === 'success' ? '#00ff00' : '#00ff00';
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `<span class="timestamp">[${timestamp}]</span><span style="color: ${color}">${message}</span>`;
            
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
        }

        // Agent ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateAgentStatus(connected) {
            const statusIndicator = document.querySelector('.status-indicator');
            const statusText = document.getElementById('statusText');
            
            if (connected) {
                statusIndicator.className = 'status-indicator status-connected';
                statusText.textContent = 'Agent ì—°ê²°ë¨ âœ“';
            } else {
                statusIndicator.className = 'status-indicator status-disconnected';
                statusText.textContent = 'Agent ì—°ê²° ì•ˆë¨ âœ—';
            }
        }

        // ë¯¸ë¦¬ ì •ì˜ëœ í”„ë¡¬í”„íŠ¸ ì „ì†¡
        function sendPredefinedPrompt(topic) {
            const prompts = {
                'ì·¨ì—…ë¥ ': 'ì°¨ì˜ê³¼í•™ëŒ€ ê²½ì˜í•™ì „ê³µì˜ ì·¨ì—…ë¥ ì€ ì–¼ë§ˆë‚˜ ë˜ë‚˜ìš”? êµ¬ì²´ì ì¸ ìˆ˜ì¹˜ì™€ í•¨ê»˜ ì„¤ëª…í•´ì£¼ì„¸ìš”.',
                'ë°”ì´ì˜¤ìœµí•©': 'ë°”ì´ì˜¤ë‚˜ ì˜ì•½í•™ ì „ê³µê³¼ ê²½ì˜í•™ì„ ê°™ì´ í•˜ë©´ ì–´ë–¤ ì ì´ ì¢‹ì€ê°€ìš”?',
                'ì„¸ë¶€ì „ê³µ': 'ê²½ì˜í•™ ì•ˆì—ëŠ” ì–´ë–¤ ì„¸ë¶€ ì „ê³µì´ ìˆë‚˜ìš”? ê°ê°ì˜ ì§„ë¡œëŠ” ë¬´ì—‡ì¸ê°€ìš”?',
                'ì°¨ë³„ì ': 'ì°¨ì˜ê³¼í•™ëŒ€ ê²½ì˜í•™ê³¼ë§Œì˜ íŠ¹ë³„í•œ ì ì€ ë¬´ì—‡ì¸ê°€ìš”?'
            };

            const prompt = prompts[topic];
            addLog(`ğŸ“¤ ì „ì†¡: ${topic} ê´€ë ¨ ì§ˆë¬¸`, 'success');
            addLog(`   â””â”€ "${prompt}"`);
            
            sendToAgent(prompt);
        }

        // ì‚¬ìš©ì ì •ì˜ í”„ë¡¬í”„íŠ¸ ì „ì†¡
        function sendCustomPrompt() {
            const prompt = document.getElementById('customPrompt').value.trim();
            
            if (!prompt) {
                alert('ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            addLog(`ğŸ“¤ ì „ì†¡: ì‚¬ìš©ì ì •ì˜ ì§ˆë¬¸`, 'success');
            addLog(`   â””â”€ "${prompt}"`);
            
            sendToAgent(prompt);
            document.getElementById('customPrompt').value = '';
        }

        // ì»¨í…ìŠ¤íŠ¸ í¬í•¨ í”„ë¡¬í”„íŠ¸ ì „ì†¡
        function sendContextPrompt(type) {
            const name = document.getElementById('studentName').value.trim();
            const interest = document.getElementById('studentInterest').value.trim();

            if (!name || !interest) {
                alert('ì´ë¦„ê³¼ ê´€ì‹¬ë¶„ì•¼ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            let prompt = '';
            if (type === 'ì§„ë¡œì¶”ì²œ') {
                prompt = `ì €ëŠ” ${name}ì´ê³ , ${interest}ì— ê´€ì‹¬ì´ ë§ìŠµë‹ˆë‹¤. ì°¨ì˜ê³¼í•™ëŒ€ ê²½ì˜í•™ì „ê³µì—ì„œ ê³µë¶€í•˜ë©´ ì–´ë–¤ ì§„ë¡œë¡œ ë‚˜ê°ˆ ìˆ˜ ìˆì„ê¹Œìš”? êµ¬ì²´ì ìœ¼ë¡œ ì¶”ì²œí•´ì£¼ì„¸ìš”.`;
            } else if (type === 'ë³µìˆ˜ì „ê³µ') {
                prompt = `ì €ëŠ” ${name}ì´ê³ , ${interest}ì— ê´€ì‹¬ì´ ë§ìŠµë‹ˆë‹¤. ê²½ì˜í•™ê³¼ í•¨ê»˜ ì–´ë–¤ ì „ê³µì„ ë³µìˆ˜ì „ê³µí•˜ë©´ ì¢‹ì„ê¹Œìš”? ì‹œë„ˆì§€ íš¨ê³¼ë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”.`;
            }

            addLog(`ğŸ“¤ ì „ì†¡: ${name}ë‹˜ì˜ ${type} ìš”ì²­`, 'success');
            addLog(`   â””â”€ ê´€ì‹¬ë¶„ì•¼: ${interest}`);
            
            sendToAgent(prompt);
        }

        // ì—°ì† ëŒ€í™” ì‹œë®¬ë ˆì´ì…˜
        async function startConversationFlow() {
            const statusDiv = document.getElementById('conversationStatus');
            statusDiv.innerHTML = '<div class="info-box">ğŸ”„ ëŒ€í™” ì‹œë‚˜ë¦¬ì˜¤ ì§„í–‰ ì¤‘...</div>';

            const flow = [
                { delay: 0, message: 'ì•ˆë…•í•˜ì„¸ìš”! ê²½ì˜í•™ì „ê³µì— ëŒ€í•´ ê¶ê¸ˆí•œ ê²Œ ìˆì–´ìš”.' },
                { delay: 5000, message: 'ì·¨ì—…ë¥ ì€ ì–¼ë§ˆë‚˜ ë˜ë‚˜ìš”?' },
                { delay: 10000, message: 'ë°”ì´ì˜¤ ë¶„ì•¼ì™€ ìœµí•©í•˜ë©´ ì–´ë–¤ ì¥ì ì´ ìˆë‚˜ìš”?' }
            ];

            for (const step of flow) {
                await new Promise(resolve => setTimeout(resolve, step.delay));
                addLog(`ğŸ“¤ ë‹¨ê³„ ${flow.indexOf(step) + 1}: ${step.message}`, 'success');
                sendToAgent(step.message);
                
                statusDiv.innerHTML = `
                    <div class="success-box">
                        âœ… ë‹¨ê³„ ${flow.indexOf(step) + 1}/3 ì™„ë£Œ<br>
                        "${step.message}"
                    </div>
                `;
            }

            statusDiv.innerHTML += '<div class="info-box">ğŸ‰ ëª¨ë“  ë‹¨ê³„ ì™„ë£Œ! Agent ì‘ë‹µì„ í™•ì¸í•˜ì„¸ìš”.</div>';
        }

        // D-ID Agentì— ì‹¤ì œë¡œ ë©”ì‹œì§€ ì „ì†¡í•˜ëŠ” í•¨ìˆ˜
        function sendToAgent(message) {
            addLog('ğŸ” Agent iframe ê²€ìƒ‰ ì¤‘...');
            
            // ë°©ë²• 1: D-ID Agent iframe ì°¾ê¸°
            setTimeout(() => {
                const agentIframe = document.querySelector('iframe[src*="d-id.com"]');
                
                if (agentIframe) {
                    addLog('âœ… Agent iframe ë°œê²¬!');
                    
                    try {
                        // postMessage ì‹œë„
                        agentIframe.contentWindow.postMessage({
                            type: 'SEND_MESSAGE',
                            message: message
                        }, '*');
                        
                        addLog('ğŸ“¨ postMessage ì „ì†¡ ì™„ë£Œ');
                    } catch (e) {
                        addLog('âš ï¸ postMessage ì‹¤íŒ¨ (CORS ì œí•œ)', 'error');
                        addLog('ğŸ’¡ ëŒ€ì•ˆ: Agent ë²„íŠ¼ í´ë¦­ ìœ ë„');
                        
                        // Agent ë²„íŠ¼ ìë™ í´ë¦­
                        const agentButton = document.querySelector('[data-name="did-agent"]');
                        if (agentButton) {
                            agentButton.click();
                            addLog('ğŸ–±ï¸ Agent ì±„íŒ…ì°½ ìë™ ì˜¤í”ˆ');
                        }
                    }
                } else {
                    addLog('âš ï¸ Agent iframeì„ ì°¾ì„ ìˆ˜ ì—†ìŒ', 'error');
                    addLog('ğŸ’¡ Agentê°€ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸° ì¤‘...');
                }
            }, 1000);

            // ë°©ë²• 2: localStorage ê³µìœ  (Agentê°€ ì½ì„ ìˆ˜ ìˆë‹¤ë©´)
            try {
                const messageData = {
                    timestamp: new Date().toISOString(),
                    message: message,
                    type: 'user_prompt'
                };
                localStorage.setItem('htmlToAgentMessage', JSON.stringify(messageData));
                addLog('ğŸ’¾ localStorageì— ë©”ì‹œì§€ ì €ì¥');
            } catch (e) {
                addLog('âš ï¸ localStorage ì €ì¥ ì‹¤íŒ¨', 'error');
            }

            // ë°©ë²• 3: Agent ë²„íŠ¼ ì§ì ‘ í´ë¦­ (ì‚¬ìš©ì ì•¡ì…˜ ìœ ë„)
            addLog('ğŸ“ ë‹¤ìŒ ë‹¨ê³„: ìš°ì¸¡ í•˜ë‹¨ Agent ë²„íŠ¼ í´ë¦­ í›„ ëŒ€í™” ì‹œì‘');
        }

        // ì´ˆê¸°í™”
        window.addEventListener('load', () => {
            addLog('ğŸš€ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ');
            addLog('ğŸ‘‰ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ì„¸ìš”');
        });

        // Agentë¡œë¶€í„° ë©”ì‹œì§€ ìˆ˜ì‹  (ë§Œì•½ ê°€ëŠ¥í•˜ë‹¤ë©´)
        window.addEventListener('message', (event) => {
            if (event.data.type === 'AGENT_RESPONSE') {
                addLog('ğŸ“¥ Agent ì‘ë‹µ ìˆ˜ì‹ :', 'success');
                addLog(`   â””â”€ "${event.data.message}"`);
            }
        });
    </script>
</body>
</html>
